!function(){"use strict";angular.module("dashboard",[])}(),function(){"use strict";angular.module("dashboard").directive("displayComponent",function(){return{restrict:"E",scope:{component:"=",dashboard:"="},templateUrl:"dashboard.component.directive.html",link:function(t,n,o){t.params=t.component.params,t.component.scope&&(t.scope=t.component.scope),t.component.states["default"]&&t.component.states["default"].controller&&(t.component.states["default"].controller(),t.component.states["default"].refreshStateSorting&&t.component.states["default"].refreshStateSorting(t.dashboard.isStateSorting)),t.openExtended=function(n){t.dashboard.isStateSorting||(t.dashboard.enableExtended(),t.component.isExtended=!0,t.component.states.extended&&t.component.states.extended.controller&&t.component.states.extended.controller())},t.closeExtended=function(n){t.dashboard.isStateSorting||(t.dashboard.isExtended=!1,t.component.isExtended=!1,t.component.states["default"]&&t.component.states["default"].controller&&t.component.states["default"].controller())},t.openSettings=function(n){t.dashboard.isStateSorting||(t.component.displaySettings=!0,t.component.states.settings&&t.component.states.settings.controller&&t.component.states.settings.controller())},t.closeSettings=function(n){t.dashboard.isStateSorting||(t.component.displaySettings=!1,t.component.states["default"]&&t.component.states["default"].controller&&t.component.states["default"].controller())}}}})}(),function(){"use strict";angular.module("dashboard").directive("dashboard",["dashboardFactory",function(t){var n,o;return{restrict:"E",scope:{id:"@",width:"@",columns:"@",columnsMinWidth:"@"},templateUrl:"dashboard.directive.html",controller:["$scope",function(e){n=$(window).width(),e.dashboard=t.get(e.id),e.dashboard.setOptions({width:e.width,columns:e.columns,columnsMinWidth:e.columnsMinWidth}),e.dashboard.refresh(),window.addEventListener("resize",function(t){$(window).width()!==n&&(n=$(window).width(),clearTimeout(o),o=setTimeout(function(){e.dashboard.refresh(),e.$apply()},150))},!0)}]}}])}(),function(){"use strict";function t(t){function n(n){return s[n]||(s[n]=new t,s[n].id=n),s[n]}function o(t){s[t]&&delete s[t]}function e(){s={}}var s={},i={get:n,remove:o,reinitialize:e};return i}angular.module("dashboard").factory("dashboardFactory",t),t.$inject=["dashboardObject"]}(),function(){"use strict";function t(t){return function(n){function o(t){return t.id=f.id+"-"+f.nbComponent,f.nbComponent++,f.components.push(t),t}function e(){var t=f.options;f.isStateSorting&&f.toggleSortable();var n=$("#"+f.id).parent().width();"auto"!==t.width&&t.width<n&&(n=t.width);var o=parseInt(n/t.columnsMinWidth);o=o?o:1,o>m&&(o=m),p!==o&&(p=o,o<t.columns?f.columnsWidth=100/o+"%":o>t.columns?f.columnsWidth=100/o+"%":f.columnsWidth=100/t.columns+"%"),t.columns=o,f.grid=[];for(var e=t.columns-1;e>=0;e--)f.grid[e]=[];f.sortable=null,f.components.forEach(function(n){var o=0,e=0,s=t.columns;if(n.positions&&n.positions[s])o=n.positions[s].column,e=n.positions[s].position;else{if("shorter"===t.algo)for(var i=t.columns-1;i>=0;i--)f.grid[i]?f.grid[i].length<=f.grid[o].length&&(o=i):(o=i,f.grid[i]=[]);else o="random"===t.algo?Math.floor(Math.random()*t.columns):0;f.grid[o]&&(e=f.grid[o].length),n.positions||(n.positions={}),n.positions[s]={},n.positions[s].column=o,n.positions[s].position=e}f.grid[o]||(f.grid[o]=[]),f.grid[o].splice(e,0,n)})}function s(t){Object.keys(t).forEach(function(n){t[n]&&(f.options[n]=t[n],"columns"===n&&(m=t[n]))})}function i(){var t=[];return f.grid.forEach(function(n){n.forEach(function(n){t.push({name:n.name,params:n.params,positions:n.positions})})}),JSON.stringify(t)}function a(n){var e=JSON.parse(n);e.forEach(function(n){if(t.has(n.name)){var e=o(new t.get(n.name)(n.params));e.positions=n.positions}})}function d(t){var n=t.from.id.replace("column",""),o=t.to.id.replace("column",""),e=f.grid[n][t.oldIndex];f.grid[n].splice(t.oldIndex,1);var s=f.options.columns;e.positions[s].column=o,f.grid[o].splice(t.newIndex,0,e),f.grid[n].forEach(function(t,o){t.positions[s].column=parseInt(n),t.positions[s].position=parseInt(o)}),f.grid[o].forEach(function(t,n){t.positions[s].column=parseInt(o),t.positions[s].position=parseInt(n)})}function r(){if(!f.sortable){f.sortable=[];for(var t=0;t<f.grid.length;t++)f.sortable.push(Sortable.create(document.getElementById("column"+t),{group:f.id,draggable:".component",disabled:!f.isStateSorting,handle:".sortable-handle",scroll:!0,scrollSensitivity:30,scrollSpeed:10,onAdd:function(t){d(t)},onUpdate:function(t){d(t)}}))}}function c(){f.options.sortable?(r(),f.isStateSorting=!f.isStateSorting,f.sortable.forEach(function(t){t.option("disabled",!f.isStateSorting)}),f.components.forEach(function(t){t.states["default"].refreshStateSorting&&t.states["default"].refreshStateSorting(f.isStateSorting)})):console.log("This dashboard does not allow sorting (see options configuration).")}function l(){f.isExtended=!0}function u(){f.isExtended=!1,f.components.forEach(function(t){t.isExtended&&(t.isExtended=!1,t.states["default"]&&t.states["default"].controller&&t.states["default"].controller())})}var p,m,h={id:null,nbComponent:0,isExtended:!1,components:[],grid:[],isStateSorting:!1,sortable:null,columnsWidth:null,options:{width:"auto",columns:"2",columnsMinWidth:null,sortable:!0,algo:"shorter"},add:o,setOptions:s,toString:i,fromString:a,enableExtended:l,disableExtended:u,refresh:e,toggleSortable:c},f=h;return f}}angular.module("dashboard").service("dashboardObject",t),t.$inject=["$injector"]}(),angular.module("dashboard").run(["$templateCache",function(t){t.put("dashboard.component.directive.html",'<div id="{{component.id}}" class="dashboard-component"><div class="default" data-ng-include="component.states.default.template" data-ng-if="!dashboard.isExtended && !component.displaySettings"></div><div class="extended" data-ng-include="component.states.extended.template" data-ng-if="component.isExtended"></div><div class="settings" data-ng-include="component.states.settings.template" data-ng-if="component.displaySettings && !dashboard.isExtended && !component.isExtended"></div></div>'),t.put("dashboard.directive.html",'<div id="dashboard-{{ id }}" class="dashboard-container" data-ng-style="{ \'width\': dashboard.options.width }"><div id="column{{$index+0}}" class="dashboard-column" data-ng-class="{ \'placeholder\' : dashboard.isStateSorting, \'shake-effect\': dashboard.isStateSorting }" data-ng-repeat="column in dashboard.grid" data-ng-style="{ \'max-width\': dashboard.columnsWidth, \'width\': dashboard.columnsWidth }"><div class="component" data-ng-repeat="component in column"><display-component component="component" dashboard="dashboard"></display-component></div></div><div class="clearfix"></div></div>')}]);
//# sourceMappingURL=angular-dashboard-fluance.min.js.map
