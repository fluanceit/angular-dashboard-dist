!function(){"use strict";angular.module("dashboard",[])}(),function(){"use strict";angular.module("dashboard").directive("displayComponent",function(){return{restrict:"E",scope:{component:"=",dashboard:"="},templateUrl:"dashboard.component.directive.html",link:function(t,n,o){t.params=t.component.params,t.component.scope&&angular.extend(t,t.component.scope),t.component.states["default"].controller(),t.openExtended=function(){t.dashboard.isStateSorting||(t.dashboard.isExtended=!0,t.component.isExtended=!0,t.component.states.extended&&t.component.states.extended.controller&&t.component.states.extended.controller())},t.closeExtended=function(){t.dashboard.isStateSorting||(t.dashboard.isExtended=!1,t.component.isExtended=!1,t.component.states["default"]&&t.component.states["default"].controller&&t.component.states["default"].controller())},t.openSettings=function(){t.dashboard.isStateSorting||(t.component.displaySettings=!0,t.component.states.settings&&t.component.states.settings.controller&&t.component.states.settings.controller())},t.closeSettings=function(){t.dashboard.isStateSorting||(t.component.displaySettings=!1,t.component.states["default"]&&t.component.states["default"].controller&&t.component.states["default"].controller())}}}})}(),function(){"use strict";angular.module("dashboard").directive("dashboard",["dashboardFactory",function(t){function n(t,n,s){i=parseInt(o/n),i>d&&(i=d),e!==i&&(e=i,a=t>i?100/i+"%":i>t?100/i+"%":100/t+"%"),void 0!==s&&s()}var o,e,i,a,d,s;return{restrict:"E",scope:{id:"@",width:"@",columns:"@",columnsMinWidth:"@"},templateUrl:"dashboard.directive.html",controller:["$scope",function(r){function c(t){if(r.dashboard.isStateSorting){var n=(new Date).getTime(),o=n-m;500>o&&o>0&&r.$apply(function(t){r.dashboard.toggleSortable()}),m=(new Date).getTime()}else h=setTimeout(function(){r.$apply(function(t){r.dashboard.toggleSortable()})},g)}function l(t){h&&clearTimeout(h)}function u(t){h&&clearTimeout(h)}o=$("#"+r.id).parent().width(),"auto"!==r.width&&o>r.width&&(o=r.width),d=r.columns,n(r.columns,r.columnsMinWidth),r.columnsWidth=a,r.dashboard=t.get(r.id),r.dashboard.setOptions({width:r.width,columns:i,columnsMinWidth:r.columnsMinWidth}),r.dashboard.drawGrid(),e=r.columns,window.addEventListener("resize",function(){clearTimeout(s),s=setTimeout(function(){o=document.getElementById(r.id).offsetWidth,n(r.columns,r.columnsMinWidth,function(){i!==r.dashboard.options.columns&&(r.columnsWidth=a,r.dashboard.setOptions({columns:i}),r.dashboard.drawGrid(),r.$apply())})},150)},!0);var p=document.getElementById(r.id),m=0,h=0,g=500;p.addEventListener("touchstart",c,!1),p.addEventListener("touchend",l,!1),p.addEventListener("touchmove",u,!1)}]}}])}(),function(){"use strict";function t(t){function n(n){return o[n]||(o[n]=new t,o[n].id=n),o[n]}var o={},e={get:n};return e}angular.module("dashboard").factory("dashboardFactory",t),t.$inject=["dashboardObject"]}(),function(){"use strict";function t(t){return function(n){function o(t,n){t.id=u.id+"-"+u.nbComponent,u.nbComponent++,u.components.push(t)}function e(){u.isStateSorting&&u.toggleSortable(),u.grid=[],u.sortable=null,u.components.forEach(function(t){var n=0,o=0,e=u.options.columns;if(t.positions&&t.positions[e])n=t.positions[e].column,o=t.positions[e].position;else{if("shorter"===u.options.algo)for(var i=u.options.columns-1;i>=0;i--)u.grid[i]?u.grid[i].length<=u.grid[n].length&&(n=i):(n=i,u.grid[i]=[]);else n="random"===u.options.algo?Math.floor(Math.random()*u.options.columns):0;u.grid[n]&&(o=u.grid[n].length),t.positions||(t.positions={}),t.positions[e]={},t.positions[e].column=n,t.positions[e].position=o}u.grid[n]||(u.grid[n]=[]),u.grid[n].splice(o,0,t)})}function i(t){Object.keys(t).forEach(function(n){t[n]&&(u.options[n]=t[n])})}function a(){var t=[],n=[];return u.grid.forEach(function(o){n=[],o.forEach(function(t){n.push({name:t.name,params:t.params,positions:t.positions})}),t.push(n)}),JSON.stringify(t)}function d(n){var e=JSON.parse(n),i=0;e.forEach(function(n){n.forEach(function(n){t.has(n.name)&&o(new t.get(n.name)(n.params,n.positions),i)}),i++})}function s(t){var n=t.from.id.replace("column",""),o=t.to.id.replace("column",""),e=u.grid[n][t.oldIndex];u.grid[n].splice(t.oldIndex,1),0===t.newIndex&&console.log(u.grid[o]),u.grid[o].splice(t.newIndex,0,e),0===t.newIndex&&console.log(u.grid[o])}function r(){if(!u.sortable){u.sortable=[];for(var t=0;t<u.grid.length;t++)u.sortable.push(Sortable.create(document.getElementById("column"+t),{group:u.id,draggable:".component",disabled:!u.isStateSorting,handle:".sortable-handle",onAdd:function(t){s(t)},onUpdate:function(t){s(t)}}))}}function c(){u.options.sortable?(r(),u.isStateSorting=!u.isStateSorting,u.sortable.forEach(function(t){t.option("disabled",!u.isStateSorting)})):console.log("This dashboard does not allow sorting (see options configuration).")}var l={id:null,nbComponent:0,isExtended:!1,components:[],grid:[],isStateSorting:!1,sortable:null,options:{width:"auto",columns:"2",columnsMinWidth:null,sortable:!0,algo:"shorter"},add:o,setOptions:i,toString:a,fromString:d,drawGrid:e,toggleSortable:c},u=l;return u}}angular.module("dashboard").service("dashboardObject",t),t.$inject=["$injector"]}(),angular.module("dashboard").run(["$templateCache",function(t){t.put("dashboard.component.directive.html",'<div id="component.id" class="dashboard-component"><div class="default" data-ng-include="component.states.default.template" data-ng-if="!dashboard.isExtended && !component.displaySettings"></div><div class="extended" data-ng-include="component.states.extended.template" data-ng-if="component.isExtended"></div><div class="settings" data-ng-include="component.states.settings.template" data-ng-if="component.displaySettings && !dashboard.isExtended"></div></div>'),t.put("dashboard.directive.html",'<div id="{{ id }}" class="dashboard-container" data-ng-style="{ \'width\': width }"><div id="column{{$index+0}}" class="dashboard-column" data-ng-class="{ \'placeholder\' : dashboard.isStateSorting, \'shake-effect\': dashboard.isStateSorting }" data-ng-repeat="column in dashboard.grid" data-ng-style="{ \'max-width\': columnsWidth, \'width\': columnsWidth }"><div class="component" data-ng-repeat="component in column"><display-component component="component" dashboard="dashboard"></display-component></div></div><div class="clearfix"></div></div>')}]);
//# sourceMappingURL=angular-dashboard-fluance.js.map
