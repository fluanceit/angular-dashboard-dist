!function(){"use strict";angular.module("dashboard",[])}(),function(){"use strict";angular.module("dashboard").directive("displayComponent",function(){return{restrict:"E",scope:{component:"=",dashboard:"="},templateUrl:"dashboard.component.directive.html",link:function(t,n,o){t.data=t.component,t.openExtended=function(){t.dashboard.isStateSorting||(t.dashboard.isExtended=!0,t.component.isExtended=!0)},t.closeExtended=function(){t.dashboard.isStateSorting||(t.dashboard.isExtended=!1,t.component.isExtended=!1)},t.openSettings=function(){t.dashboard.isStateSorting||(t.component.displaySettings=!0)},t.closeSettings=function(){t.dashboard.isStateSorting||(t.component.displaySettings=!1)}}}})}(),function(){"use strict";angular.module("dashboard").directive("dashboard",["dashboardFactory",function(t){function n(t,n,s){e=parseInt(o/n),e>a&&(e=a),i!==e&&(i=e,d=t>e?100/e+"%":e>t?100/e+"%":100/t+"%"),void 0!==s&&s()}var o,i,e,d,a,s;return{restrict:"E",scope:{id:"@",width:"@",columns:"@",columnsMinWidth:"@"},templateUrl:"dashboard.directive.html",controller:["$scope",function(r){function c(t){if(r.dashboard.isStateSorting){var n=(new Date).getTime(),o=n-p;500>o&&o>0&&r.$apply(function(t){r.dashboard.toggleSortable()}),p=(new Date).getTime()}else h=setTimeout(function(){r.$apply(function(t){r.dashboard.toggleSortable()})},g)}function l(t){h&&clearTimeout(h)}function u(t){h&&clearTimeout(h)}o=$("#"+r.id).parent().width(),"auto"!==r.width&&o>r.width&&(o=r.width),a=r.columns,n(r.columns,r.columnsMinWidth),r.columnsWidth=d,r.dashboard=t.get(r.id),r.dashboard.setOptions({width:r.width,columns:e,columnsMinWidth:r.columnsMinWidth}),r.dashboard.drawGrid(),i=r.columns,window.addEventListener("resize",function(){clearTimeout(s),s=setTimeout(function(){o=document.getElementById(r.id).offsetWidth,n(r.columns,r.columnsMinWidth,function(){e!==r.dashboard.options.columns&&(r.columnsWidth=d,r.dashboard.setOptions({columns:e}),r.dashboard.drawGrid(),r.$apply())})},150)},!0);var m=document.getElementById(r.id),p=0,h=0,g=500;m.addEventListener("touchstart",c,!1),m.addEventListener("touchend",l,!1),m.addEventListener("touchmove",u,!1)}]}}])}(),function(){"use strict";function t(t){function n(n){return o[n]||(o[n]=new t,o[n].id=n),o[n]}var o={},i={get:n};return i}angular.module("dashboard").factory("dashboardFactory",t),t.$inject=["dashboardObject"]}(),function(){"use strict";function t(t){return function(n){function o(t,n){t.id=u.id+"-"+u.nbComponent,u.nbComponent++,u.components.push(t)}function i(){u.isStateSorting&&u.toggleSortable(),u.grid=[],u.sortable=null,u.components.forEach(function(t){var n=0,o=0,i=u.options.columns;if(t.positions&&t.positions[i])n=t.positions[i].column,o=t.positions[i].position;else{if("shorter"===u.options.algo)for(var e=u.options.columns-1;e>=0;e--)u.grid[e]?u.grid[e].length<=u.grid[n].length&&(n=e):(n=e,u.grid[e]=[]);else n="random"===u.options.algo?Math.floor(Math.random()*u.options.columns):0;u.grid[n]&&(o=u.grid[n].length),t.positions||(t.positions={}),t.positions[i]={},t.positions[i].column=n,t.positions[i].position=o}u.grid[n]||(u.grid[n]=[]),u.grid[n].splice(o,0,t)})}function e(t){Object.keys(t).forEach(function(n){t[n]&&(u.options[n]=t[n])})}function d(){var t=[],n=[];return u.grid.forEach(function(o){n=[],o.forEach(function(t){n.push({name:t.name,params:t.params,positions:t.positions})}),t.push(n)}),JSON.stringify(t)}function a(n){var i=JSON.parse(n),e=0;i.forEach(function(n){n.forEach(function(n){t.has(n.name)&&o(new t.get(n.name)(n.params,n.positions),e)}),e++})}function s(t){var n=t.from.id.replace("column",""),o=t.to.id.replace("column",""),i=u.grid[n][t.oldIndex];u.grid[n].splice(t.oldIndex,1),u.grid[o].splice(t.newIndex,0,i)}function r(){if(!u.sortable){u.sortable=[];for(var t=0;t<u.grid.length;t++)u.sortable.push(Sortable.create(document.getElementById("column"+t),{group:u.id,draggable:".component",disabled:!u.isStateSorting,handle:".sortable-handle",onAdd:function(t){s(t)},onUpdate:function(t){s(t)}}))}}function c(){u.options.sortable?(r(),u.isStateSorting=!u.isStateSorting,u.sortable.forEach(function(t){t.option("disabled",!u.isStateSorting)})):console.log("This dashboard does not allow sorting (see options configuration).")}var l={id:null,nbComponent:0,isExtended:!1,components:[],grid:[],isStateSorting:!1,sortable:null,options:{width:"auto",columns:"2",columnsMinWidth:null,sortable:!0,algo:"shorter"},add:o,setOptions:e,toString:d,fromString:a,drawGrid:i,toggleSortable:c},u=l;return u}}angular.module("dashboard").service("dashboardObject",t),t.$inject=["$injector"]}(),angular.module("dashboard").run(["$templateCache",function(t){t.put("dashboard.component.directive.html",'<div id="component.id" class="dashboard-component" data-ng-class="{\'shake-effect\': dashboard.isStateSorting}"><div class="default" data-ng-include="component.templates.default" data-ng-if="!dashboard.isExtended && !component.displaySettings"></div><div class="extended" data-ng-include="component.templates.extended" data-ng-if="component.isExtended"></div><div class="settings" data-ng-include="component.templates.settings" data-ng-if="component.displaySettings && !dashboard.isExtended"></div></div>'),t.put("dashboard.directive.html",'<div id="{{ id }}" class="dashboard-container" data-ng-style="{ \'width\': width }"><div id="column{{$index+0}}" class="column" data-ng-class="{ placeholder : dashboard.isStateSorting }" data-ng-repeat="column in dashboard.grid" data-ng-style="{ \'max-width\': columnsWidth, \'width\': columnsWidth, \'height\': columnsWidth }"><div class="component" data-ng-repeat="component in column"><display-component component="component" dashboard="dashboard"></display-component></div></div><div class="clearfix"></div></div>')}]);