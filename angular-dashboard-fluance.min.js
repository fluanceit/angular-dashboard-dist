!function(){"use strict";angular.module("dashboard",[])}(),function(){"use strict";angular.module("dashboard").directive("displayComponent",function(){return{restrict:"E",scope:{component:"=",dashboard:"="},templateUrl:"dashboard.component.directive.html",link:function(t,n,o){t.params=t.component.params,t.component.scope&&(t.scope=t.component.scope),t.component.states["default"]&&t.component.states["default"].controller&&t.component.states["default"].controller(),t.openExtended=function(){t.dashboard.isStateSorting||(t.dashboard.isExtended=!0,t.component.isExtended=!0,t.component.states.extended&&t.component.states.extended.controller&&t.component.states.extended.controller())},t.closeExtended=function(){t.dashboard.isStateSorting||(t.dashboard.isExtended=!1,t.component.isExtended=!1,t.component.states["default"]&&t.component.states["default"].controller&&t.component.states["default"].controller())},t.openSettings=function(){t.dashboard.isStateSorting||(t.component.displaySettings=!0,t.component.states.settings&&t.component.states.settings.controller&&t.component.states.settings.controller())},t.closeSettings=function(){t.dashboard.isStateSorting||(t.component.displaySettings=!1,t.component.states["default"]&&t.component.states["default"].controller&&t.component.states["default"].controller())}}}})}(),function(){"use strict";angular.module("dashboard").directive("dashboard",["dashboardFactory",function(t){function n(t,n,a){i=parseInt(o/n),i>s&&(i=s),e!==i&&(e=i,d=t>i?100/i+"%":i>t?100/i+"%":100/t+"%"),void 0!==a&&a()}var o,e,i,d,s,a;return{restrict:"E",scope:{id:"@",width:"@",columns:"@",columnsMinWidth:"@"},templateUrl:"dashboard.directive.html",controller:["$scope",function(r){function c(t){if(r.dashboard.isStateSorting){var n=(new Date).getTime(),o=n-m;500>o&&o>0&&r.$apply(function(t){r.dashboard.toggleSortable()}),m=(new Date).getTime()}else h=setTimeout(function(){r.$apply(function(t){r.dashboard.toggleSortable()})},g)}function l(t){h&&clearTimeout(h)}function u(t){h&&clearTimeout(h)}o=$("#"+r.id).parent().width(),"auto"!==r.width&&o>r.width&&(o=r.width),s=r.columns,n(r.columns,r.columnsMinWidth),r.columnsWidth=d,r.dashboard=t.get(r.id),r.dashboard.setOptions({width:r.width,columns:i,columnsMinWidth:r.columnsMinWidth}),r.dashboard.drawGrid(),e=r.columns,window.addEventListener("resize",function(){clearTimeout(a),a=setTimeout(function(){o=document.getElementById(r.id).offsetWidth,n(r.columns,r.columnsMinWidth,function(){i!==r.dashboard.options.columns&&(r.columnsWidth=d,r.dashboard.setOptions({columns:i}),r.dashboard.drawGrid(),r.$apply())})},150)},!0);var p=document.getElementById(r.id),m=0,h=0,g=500;p.addEventListener("touchstart",c,!1),p.addEventListener("touchend",l,!1),p.addEventListener("touchmove",u,!1)}]}}])}(),function(){"use strict";function t(t){function n(n){return o[n]||(o[n]=new t,o[n].id=n),o[n]}var o={},e={get:n};return e}angular.module("dashboard").factory("dashboardFactory",t),t.$inject=["dashboardObject"]}(),function(){"use strict";function t(t){return function(n){function o(t,n){t.id=p.id+"-"+p.nbComponent,p.nbComponent++,p.components.push(t)}function e(){p.isStateSorting&&p.toggleSortable(),p.grid=[],p.sortable=null,p.components.forEach(function(t){var n=0,o=0,e=p.options.columns;if(t.positions&&t.positions[e])n=t.positions[e].column,o=t.positions[e].position;else{if("shorter"===p.options.algo)for(var i=p.options.columns-1;i>=0;i--)p.grid[i]?p.grid[i].length<=p.grid[n].length&&(n=i):(n=i,p.grid[i]=[]);else n="random"===p.options.algo?Math.floor(Math.random()*p.options.columns):0;p.grid[n]&&(o=p.grid[n].length),t.positions||(t.positions={}),t.positions[e]={},t.positions[e].column=n,t.positions[e].position=o}p.grid[n]||(p.grid[n]=[]),p.grid[n].splice(o,0,t)})}function i(t){Object.keys(t).forEach(function(n){t[n]&&(p.options[n]=t[n])})}function d(){var t=[],n=[];return p.grid.forEach(function(o){n=[],o.forEach(function(t){n.push({name:t.name,params:t.params,positions:t.positions})}),t.push(n)}),JSON.stringify(t)}function s(n){var e=JSON.parse(n),i=0;e.forEach(function(n){n.forEach(function(n){t.has(n.name)&&o(new t.get(n.name)(n.params,n.positions),i)}),i++})}function a(t){var n=t.from.id.replace("column",""),o=t.to.id.replace("column",""),e=p.grid[n][t.oldIndex];p.grid[n].splice(t.oldIndex,1),0===t.newIndex&&console.log(p.grid[o]),p.grid[o].splice(t.newIndex,0,e),0===t.newIndex&&console.log(p.grid[o])}function r(){if(!p.sortable){p.sortable=[];for(var t=0;t<p.grid.length;t++)p.sortable.push(Sortable.create(document.getElementById("column"+t),{group:p.id,draggable:".component",disabled:!p.isStateSorting,handle:".sortable-handle",onAdd:function(t){a(t)},onUpdate:function(t){a(t)}}))}}function c(){p.options.sortable?(r(),p.isStateSorting=!p.isStateSorting,p.sortable.forEach(function(t){t.option("disabled",!p.isStateSorting)})):console.log("This dashboard does not allow sorting (see options configuration).")}function l(){p.isExtended=!1,p.components.forEach(function(t){t.isExtended&&(t.isExtended=!1)})}var u={id:null,nbComponent:0,isExtended:!1,components:[],grid:[],isStateSorting:!1,sortable:null,options:{width:"auto",columns:"2",columnsMinWidth:null,sortable:!0,algo:"shorter"},add:o,setOptions:i,toString:d,fromString:s,disableExtended:l,drawGrid:e,toggleSortable:c},p=u;return p}}angular.module("dashboard").service("dashboardObject",t),t.$inject=["$injector"]}(),angular.module("dashboard").run(["$templateCache",function(t){t.put("dashboard.component.directive.html",'<div id="component.id" class="dashboard-component"><div class="default" data-ng-include="component.states.default.template" data-ng-if="!dashboard.isExtended && !component.displaySettings"></div><div class="extended" data-ng-include="component.states.extended.template" data-ng-if="component.isExtended"></div><div class="settings" data-ng-include="component.states.settings.template" data-ng-if="component.displaySettings && !dashboard.isExtended"></div></div>'),t.put("dashboard.directive.html",'<div id="{{ id }}" class="dashboard-container" data-ng-style="{ \'width\': width }"><div id="column{{$index+0}}" class="dashboard-column" data-ng-class="{ \'placeholder\' : dashboard.isStateSorting, \'shake-effect\': dashboard.isStateSorting }" data-ng-repeat="column in dashboard.grid" data-ng-style="{ \'max-width\': columnsWidth, \'width\': columnsWidth }"><div class="component" data-ng-repeat="component in column"><display-component component="component" dashboard="dashboard"></display-component></div></div><div class="clearfix"></div></div>')}]);
//# sourceMappingURL=angular-dashboard-fluance.js.map
