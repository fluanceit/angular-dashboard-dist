!function(){"use strict";angular.module("dashboard",[])}(),function(){"use strict";angular.module("dashboard").directive("displayComponent",function(){return{restrict:"E",scope:{component:"=",dashboard:"="},templateUrl:"dashboard.component.directive.html",link:function(n,t,o){n.params=n.component.params,n.component.scope&&angular.extend(n,n.component.scope),n.openExtended=function(){n.dashboard.isStateSorting||(n.dashboard.isExtended=!0,n.component.isExtended=!0)},n.closeExtended=function(){n.dashboard.isStateSorting||(n.dashboard.isExtended=!1,n.component.isExtended=!1)},n.openSettings=function(){n.dashboard.isStateSorting||(n.component.displaySettings=!0)},n.closeSettings=function(){n.dashboard.isStateSorting||(n.component.displaySettings=!1)}}}})}(),function(){"use strict";angular.module("dashboard").directive("dashboard",["dashboardFactory",function(n){function t(n,t,s){e=parseInt(o/t),e>a&&(e=a),i!==e&&(i=e,d=n>e?100/e+"%":e>n?100/e+"%":100/n+"%"),void 0!==s&&s()}var o,i,e,d,a,s;return{restrict:"E",scope:{id:"@",width:"@",columns:"@",columnsMinWidth:"@"},templateUrl:"dashboard.directive.html",controller:["$scope",function(r){function c(n){if(r.dashboard.isStateSorting){var t=(new Date).getTime(),o=t-m;500>o&&o>0&&r.$apply(function(n){r.dashboard.toggleSortable()}),m=(new Date).getTime()}else h=setTimeout(function(){r.$apply(function(n){r.dashboard.toggleSortable()})},g)}function l(n){h&&clearTimeout(h)}function u(n){h&&clearTimeout(h)}o=$("#"+r.id).parent().width(),"auto"!==r.width&&o>r.width&&(o=r.width),a=r.columns,t(r.columns,r.columnsMinWidth),r.columnsWidth=d,r.dashboard=n.get(r.id),r.dashboard.setOptions({width:r.width,columns:e,columnsMinWidth:r.columnsMinWidth}),r.dashboard.drawGrid(),i=r.columns,window.addEventListener("resize",function(){clearTimeout(s),s=setTimeout(function(){o=document.getElementById(r.id).offsetWidth,t(r.columns,r.columnsMinWidth,function(){e!==r.dashboard.options.columns&&(r.columnsWidth=d,r.dashboard.setOptions({columns:e}),r.dashboard.drawGrid(),r.$apply())})},150)},!0);var p=document.getElementById(r.id),m=0,h=0,g=500;p.addEventListener("touchstart",c,!1),p.addEventListener("touchend",l,!1),p.addEventListener("touchmove",u,!1)}]}}])}(),function(){"use strict";function n(n){function t(t){return o[t]||(o[t]=new n,o[t].id=t),o[t]}var o={},i={get:t};return i}angular.module("dashboard").factory("dashboardFactory",n),n.$inject=["dashboardObject"]}(),function(){"use strict";function n(n){return function(t){function o(n,t){n.id=u.id+"-"+u.nbComponent,u.nbComponent++,u.components.push(n)}function i(){u.isStateSorting&&u.toggleSortable(),u.grid=[],u.sortable=null,u.components.forEach(function(n){var t=0,o=0,i=u.options.columns;if(n.positions&&n.positions[i])t=n.positions[i].column,o=n.positions[i].position;else{if("shorter"===u.options.algo)for(var e=u.options.columns-1;e>=0;e--)u.grid[e]?u.grid[e].length<=u.grid[t].length&&(t=e):(t=e,u.grid[e]=[]);else t="random"===u.options.algo?Math.floor(Math.random()*u.options.columns):0;u.grid[t]&&(o=u.grid[t].length),n.positions||(n.positions={}),n.positions[i]={},n.positions[i].column=t,n.positions[i].position=o}u.grid[t]||(u.grid[t]=[]),u.grid[t].splice(o,0,n)})}function e(n){Object.keys(n).forEach(function(t){n[t]&&(u.options[t]=n[t])})}function d(){var n=[],t=[];return u.grid.forEach(function(o){t=[],o.forEach(function(n){t.push({name:n.name,params:n.params,positions:n.positions})}),n.push(t)}),JSON.stringify(n)}function a(t){var i=JSON.parse(t),e=0;i.forEach(function(t){t.forEach(function(t){n.has(t.name)&&o(new n.get(t.name)(t.params,t.positions),e)}),e++})}function s(n){var t=n.from.id.replace("column",""),o=n.to.id.replace("column",""),i=u.grid[t][n.oldIndex];u.grid[t].splice(n.oldIndex,1),0===n.newIndex&&console.log(u.grid[o]),u.grid[o].splice(n.newIndex,0,i),0===n.newIndex&&console.log(u.grid[o])}function r(){if(!u.sortable){u.sortable=[];for(var n=0;n<u.grid.length;n++)u.sortable.push(Sortable.create(document.getElementById("column"+n),{group:u.id,draggable:".component",disabled:!u.isStateSorting,handle:".sortable-handle",onAdd:function(n){s(n)},onUpdate:function(n){s(n)}}))}}function c(){u.options.sortable?(r(),u.isStateSorting=!u.isStateSorting,u.sortable.forEach(function(n){n.option("disabled",!u.isStateSorting)})):console.log("This dashboard does not allow sorting (see options configuration).")}var l={id:null,nbComponent:0,isExtended:!1,components:[],grid:[],isStateSorting:!1,sortable:null,options:{width:"auto",columns:"2",columnsMinWidth:null,sortable:!0,algo:"shorter"},add:o,setOptions:e,toString:d,fromString:a,drawGrid:i,toggleSortable:c},u=l;return u}}angular.module("dashboard").service("dashboardObject",n),n.$inject=["$injector"]}(),angular.module("dashboard").run(["$templateCache",function(n){n.put("dashboard.component.directive.html",'<div id="component.id" class="dashboard-component"><div class="default" data-ng-include="component.templates.default" data-ng-if="!dashboard.isExtended && !component.displaySettings"></div><div class="extended" data-ng-include="component.templates.extended" data-ng-if="component.isExtended"></div><div class="settings" data-ng-include="component.templates.settings" data-ng-if="component.displaySettings && !dashboard.isExtended"></div></div>'),n.put("dashboard.directive.html",'<div id="{{ id }}" class="dashboard-container" data-ng-style="{ \'width\': width }"><div id="column{{$index+0}}" class="dashboard-column" data-ng-class="{ \'placeholder\' : dashboard.isStateSorting, \'shake-effect\': dashboard.isStateSorting }" data-ng-repeat="column in dashboard.grid" data-ng-style="{ \'max-width\': columnsWidth, \'width\': columnsWidth }"><div class="component" data-ng-repeat="component in column"><display-component component="component" dashboard="dashboard"></display-component></div></div><div class="clearfix"></div></div>')}]);
//# sourceMappingURL=angular-dashboard-fluance.js.map
